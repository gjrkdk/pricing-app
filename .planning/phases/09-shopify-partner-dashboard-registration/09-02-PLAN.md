---
phase: 09-shopify-partner-dashboard-registration
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "App installs successfully on a development store from Partner Dashboard"
    - "OAuth flow completes without errors (scopes approved, token exchanged)"
    - "Merchant lands on embedded dashboard inside Shopify admin after install"
    - "Embedded dashboard renders Polaris UI (not a blank page or error)"
  artifacts: []
  key_links:
    - from: "Partner Dashboard Install button"
      to: "https://quote-flow-one.vercel.app"
      via: "Shopify OAuth redirect"
      pattern: "302.*quote-flow-one"
    - from: "https://quote-flow-one.vercel.app/auth/callback"
      to: "Embedded dashboard /app"
      via: "Token exchange + session creation"
      pattern: "authenticate.admin"
---

<objective>
Test the complete OAuth install flow by installing QuoteFlow on a development store from Partner Dashboard, verifying the merchant lands on the embedded dashboard.

Purpose: This validates requirements APP-02 (installable via direct link) and APP-03 (OAuth install flow works end-to-end on production). Without this test, we cannot confirm the production deployment, Partner Dashboard config, and OAuth flow work together correctly.

Output: Verified working install flow on a development store.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-shopify-partner-dashboard-registration/09-RESEARCH.md
@.planning/phases/09-shopify-partner-dashboard-registration/09-01-SUMMARY.md
@app/shopify.server.ts
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Install QuoteFlow on development store and verify OAuth flow</name>
  <what-built>
    Phase 09 Plan 01 configured the Partner Dashboard with Public distribution and deployed the production TOML. The app should now be installable on development stores.
  </what-built>
  <how-to-verify>
    **Install the app:**
    1. Open Shopify Partner Dashboard: https://partners.shopify.com
    2. Navigate to: Apps → QuoteFlow → Home (or Overview)
    3. Find the "Test your app" or "Installs" section
    4. Click "Install app" or "Select store"
    5. Choose development store: **pricing-app-3** (or create a new one for a fresh test)
    6. Shopify shows OAuth permission screen — verify it requests:
       - `write_draft_orders`
       - `read_products`
       - `write_products`
    7. Click "Install app" to approve

    **Verify post-install:**
    8. After OAuth completes, you should land on the embedded QuoteFlow dashboard inside Shopify admin
    9. Verify the page shows:
       - Polaris UI components (not a blank page or error)
       - Dashboard content (API key section, matrix controls, onboarding banner)
       - URL in browser is something like: `https://admin.shopify.com/store/pricing-app-3/apps/quoteflow/app`
    10. Navigate to a few pages within the app to confirm embedded navigation works

    **If the install fails:**
    - Check browser console for errors
    - Check if the URL redirects properly (should go through /auth/callback)
    - Verify Partner Dashboard shows correct redirect_urls
    - Report the exact error message or behavior
  </how-to-verify>
  <resume-signal>
    Type "approved" if:
    - OAuth flow completed successfully
    - Embedded dashboard loaded with Polaris UI
    - App is accessible inside Shopify admin

    Or describe the exact issue:
    - "OAuth error: [message]"
    - "Blank page after install"
    - "Redirect loop"
    - etc.
  </resume-signal>
</task>

</tasks>

<verification>
1. QuoteFlow is installed on the development store (visible in store admin under Apps)
2. OAuth flow completed without redirect errors or token exchange failures
3. Embedded dashboard renders Polaris UI inside Shopify admin iframe
4. Navigation within the embedded app works (no full-page reloads or session loss)
5. Requirements satisfied:
   - APP-01: OAuth redirects and scopes configured correctly (proven by successful install)
   - APP-02: App installable via Partner Dashboard install button (proven by completing install)
   - APP-03: OAuth install flow works end-to-end on production (proven by landing on dashboard)
</verification>

<success_criteria>
- App installed successfully on development store
- OAuth flow completed (scopes approved, session created in Neon database)
- Merchant sees embedded dashboard with Polaris UI inside Shopify admin
- No OAuth errors, redirect loops, or blank pages
</success_criteria>

<output>
After completion, create `.planning/phases/09-shopify-partner-dashboard-registration/09-02-SUMMARY.md`
</output>
